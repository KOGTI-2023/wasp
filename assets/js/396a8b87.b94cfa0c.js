"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[83649],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>d});var r=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var u=r.createContext({}),l=function(e){var t=r.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=l(e.components);return r.createElement(u.Provider,{value:t},e.children)},c="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,u=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),c=l(n),m=o,d=c["".concat(u,".").concat(m)]||c[m]||h[m]||a;return n?r.createElement(d,s(s({ref:t},p),{},{components:n})):r.createElement(d,s({ref:t},p))}));function d(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,s=new Array(a);s[0]=m;var i={};for(var u in t)hasOwnProperty.call(t,u)&&(i[u]=t[u]);i.originalType=e,i[c]="string"==typeof e?e:o,s[1]=i;for(var l=2;l<a;l++)s[l]=n[l];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},38610:(e,t,n)=>{n.d(t,{Z:()=>a});var r=n(67294),o=n(44996);const a=e=>r.createElement("div",null,r.createElement("p",{align:"center"},r.createElement("figure",null,r.createElement("img",{style:{width:e.width},alt:e.alt,src:(0,o.Z)(e.source)}),r.createElement("figcaption",{class:"image-caption",style:{fontStyle:"italic",opacity:.6,fontSize:"0.9rem"}},e.caption))))},85162:(e,t,n)=>{n.d(t,{Z:()=>s});var r=n(67294),o=n(86010);const a={tabItem:"tabItem_Ymn6"};function s(e){let{children:t,hidden:n,className:s}=e;return r.createElement("div",{role:"tabpanel",className:(0,o.Z)(a.tabItem,s),hidden:n},t)}},74866:(e,t,n)=>{n.d(t,{Z:()=>N});var r=n(87462),o=n(67294),a=n(86010),s=n(12466),i=n(16550),u=n(91980),l=n(67392),p=n(50012);function c(e){return function(e){return o.Children.map(e,(e=>{if(!e||(0,o.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:n,attributes:r,default:o}}=e;return{value:t,label:n,attributes:r,default:o}}))}function h(e){const{values:t,children:n}=e;return(0,o.useMemo)((()=>{const e=t??c(n);return function(e){const t=(0,l.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function m(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function d(e){let{queryString:t=!1,groupId:n}=e;const r=(0,i.k6)(),a=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,u._X)(a),(0,o.useCallback)((e=>{if(!a)return;const t=new URLSearchParams(r.location.search);t.set(a,e),r.replace({...r.location,search:t.toString()})}),[a,r])]}function k(e){const{defaultValue:t,queryString:n=!1,groupId:r}=e,a=h(e),[s,i]=(0,o.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!m({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const r=n.find((e=>e.default))??n[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:t,tabValues:a}))),[u,l]=d({queryString:n,groupId:r}),[c,k]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[r,a]=(0,p.Nk)(n);return[r,(0,o.useCallback)((e=>{n&&a.set(e)}),[n,a])]}({groupId:r}),f=(()=>{const e=u??c;return m({value:e,tabValues:a})?e:null})();(0,o.useLayoutEffect)((()=>{f&&i(f)}),[f]);return{selectedValue:s,selectValue:(0,o.useCallback)((e=>{if(!m({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);i(e),l(e),k(e)}),[l,k,a]),tabValues:a}}var f=n(72389);const g={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function b(e){let{className:t,block:n,selectedValue:i,selectValue:u,tabValues:l}=e;const p=[],{blockElementScrollPositionUntilNextRender:c}=(0,s.o5)(),h=e=>{const t=e.currentTarget,n=p.indexOf(t),r=l[n].value;r!==i&&(c(t),u(r))},m=e=>{let t=null;switch(e.key){case"Enter":h(e);break;case"ArrowRight":{const n=p.indexOf(e.currentTarget)+1;t=p[n]??p[0];break}case"ArrowLeft":{const n=p.indexOf(e.currentTarget)-1;t=p[n]??p[p.length-1];break}}t?.focus()};return o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.Z)("tabs",{"tabs--block":n},t)},l.map((e=>{let{value:t,label:n,attributes:s}=e;return o.createElement("li",(0,r.Z)({role:"tab",tabIndex:i===t?0:-1,"aria-selected":i===t,key:t,ref:e=>p.push(e),onKeyDown:m,onClick:h},s,{className:(0,a.Z)("tabs__item",g.tabItem,s?.className,{"tabs__item--active":i===t})}),n??t)})))}function y(e){let{lazy:t,children:n,selectedValue:r}=e;const a=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=a.find((e=>e.props.value===r));return e?(0,o.cloneElement)(e,{className:"margin-top--md"}):null}return o.createElement("div",{className:"margin-top--md"},a.map(((e,t)=>(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==r}))))}function v(e){const t=k(e);return o.createElement("div",{className:(0,a.Z)("tabs-container",g.tabList)},o.createElement(b,(0,r.Z)({},e,t)),o.createElement(y,(0,r.Z)({},e,t)))}function N(e){const t=(0,f.Z)();return o.createElement(v,(0,r.Z)({key:String(t)},e))}},46300:(e,t,n)=>{n.d(t,{Z:()=>a});var r=n(67294),o=n(50012);function a(e){let{path:t}=e;const[n]=(0,o.Nk)("docusaurus.tab.js-ts"),a=t.lastIndexOf("{"),s=t.slice(a+1,t.length-1),[i,u]=s.split(","),l=t.slice(0,a);return r.createElement("code",null,l+("js"===n?i:u))}},81304:(e,t,n)=>{n.d(t,{Nl:()=>u,f3:()=>i,ge:()=>s,p5:()=>p,xQ:()=>c,xS:()=>l});var r=n(67294),o=n(39960);function a(e){let{children:t,linkToPage:n,style:a={}}=e;return r.createElement(o.Z,{to:n,style:{padding:"0.1rem 0.5rem",borderRadius:"0.375rem",color:"var(--auth-pills-color)",textDecoration:"none",display:"inline-block",...a}},t)}function s(){return r.createElement(a,{style:{backgroundColor:"var(--auth-pills-email)"},linkToPage:"/docs/auth/email"},"Email")}function i(){return r.createElement(a,{style:{backgroundColor:"var(--auth-pills-username-and-pass)"},linkToPage:"/docs/auth/username-and-pass"},"Username & Password")}function u(){return r.createElement(a,{style:{backgroundColor:"var(--auth-pills-discord)"},linkToPage:"/docs/auth/social-auth/discord"},"Discord")}function l(){return r.createElement(a,{style:{backgroundColor:"var(--auth-pills-github)"},linkToPage:"/docs/auth/social-auth/github"},"Github")}function p(){return r.createElement(a,{style:{backgroundColor:"var(--auth-pills-google)"},linkToPage:"/docs/auth/social-auth/google"},"Google")}function c(){return r.createElement(a,{style:{backgroundColor:"var(--auth-pills-keycloak)"},linkToPage:"/docs/auth/social-auth/keycloak"},"Keycloak")}},63865:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>h,contentTitle:()=>p,default:()=>f,frontMatter:()=>l,metadata:()=>c,toc:()=>m});var r=n(87462),o=(n(67294),n(3905)),a=(n(46300),n(85162)),s=n(74866),i=n(81304),u=n(38610);const l={title:"Auth Hooks"},p=void 0,c={unversionedId:"auth/auth-hooks",id:"version-0.14.0/auth/auth-hooks",title:"Auth Hooks",description:'Auth hooks allow you to "hook into" the auth process at various stages and run your custom code. For example, if you want to forbid certain emails from signing up, or if you wish to send a welcome email to the user after they sign up, auth hooks are the way to go.',source:"@site/versioned_docs/version-0.14.0/auth/auth-hooks.md",sourceDirName:"auth",slug:"/auth/auth-hooks",permalink:"/docs/auth/auth-hooks",draft:!1,editUrl:"https://github.com/wasp-lang/wasp/edit/release/web/versioned_docs/version-0.14.0/auth/auth-hooks.md",tags:[],version:"0.14.0",frontMatter:{title:"Auth Hooks"},sidebar:"docs",previous:{title:"Accessing User Data",permalink:"/docs/auth/entities/"},next:{title:"Starter Templates",permalink:"/docs/project/starter-templates"}},h={},m=[{value:"Supported hooks",id:"supported-hooks",level:2},{value:"Using hooks",id:"using-hooks",level:2},{value:"Executing code before the user signs up",id:"executing-code-before-the-user-signs-up",level:3},{value:"Executing code after the user signs up",id:"executing-code-after-the-user-signs-up",level:3},{value:"Executing code before the OAuth redirect",id:"executing-code-before-the-oauth-redirect",level:3},{value:"API Reference",id:"api-reference",level:2},{value:"The <code>onBeforeSignup</code> hook",id:"the-onbeforesignup-hook",level:3},{value:"The <code>onAfterSignup</code> hook",id:"the-onaftersignup-hook",level:3},{value:"The <code>onBeforeOAuthRedirect</code> hook",id:"the-onbeforeoauthredirect-hook",level:3}],d={toc:m},k="wrapper";function f(e){let{components:t,...n}=e;return(0,o.kt)(k,(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,'Auth hooks allow you to "hook into" the auth process at various stages and run your custom code. For example, if you want to forbid certain emails from signing up, or if you wish to send a welcome email to the user after they sign up, auth hooks are the way to go.'),(0,o.kt)("h2",{id:"supported-hooks"},"Supported hooks"),(0,o.kt)("p",null,"The following auth hooks are available in Wasp:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#executing-code-before-the-user-signs-up"},(0,o.kt)("inlineCode",{parentName:"a"},"onBeforeSignup"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#executing-code-after-the-user-signs-up"},(0,o.kt)("inlineCode",{parentName:"a"},"onAfterSignup"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#executing-code-before-the-oauth-redirect"},(0,o.kt)("inlineCode",{parentName:"a"},"onBeforeOAuthRedirect")))),(0,o.kt)("p",null,"We'll go through each of these hooks in detail. But first, let's see how the hooks fit into the signup flow:"),(0,o.kt)(u.Z,{source:"/img/auth-hooks/signup_flow_with_hooks.png",alt:"Signup Flow with Hooks",caption:"Signup Flow with Hooks",mdxType:"ImgWithCaption"}),(0,o.kt)("p",null,"If you are using OAuth, the flow includes extra steps before the signup flow:"),(0,o.kt)(u.Z,{source:"/img/auth-hooks/oauth_flow_with_hooks.png",alt:"OAuth Flow with Hooks",caption:"OAuth Flow with Hooks",mdxType:"ImgWithCaption"}),(0,o.kt)("h2",{id:"using-hooks"},"Using hooks"),(0,o.kt)("p",null,"To use auth hooks, you must first declare them in the Wasp file:"),(0,o.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,o.kt)(a.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-wasp"},'app myApp {\n  wasp: {\n    version: "^0.13.0"\n  },\n  auth: {\n    userEntity: User,\n    methods: {\n      ...\n    },\n    onBeforeSignup: import { onBeforeSignup } from "@src/auth/hooks",\n    onAfterSignup: import { onAfterSignup } from "@src/auth/hooks",\n    onBeforeOAuthRedirect: import { onBeforeOAuthRedirect } from "@src/auth/hooks",\n  },\n}\n'))),(0,o.kt)(a.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-wasp"},'app myApp {\n  wasp: {\n    version: "^0.13.0"\n  },\n  auth: {\n    userEntity: User,\n    methods: {\n      ...\n    },\n    onBeforeSignup: import { onBeforeSignup } from "@src/auth/hooks",\n    onAfterSignup: import { onAfterSignup } from "@src/auth/hooks",\n    onBeforeOAuthRedirect: import { onBeforeOAuthRedirect } from "@src/auth/hooks",\n  },\n}\n')))),(0,o.kt)("p",null,"If the hooks are defined as async functions, Wasp ",(0,o.kt)("em",{parentName:"p"},"awaits")," them. This means the auth process waits for the hooks to finish before continuing."),(0,o.kt)("p",null,"Wasp ignores the hooks' return values. The only exception is the ",(0,o.kt)("inlineCode",{parentName:"p"},"onBeforeOAuthRedirect")," hook, whose return value affects the OAuth redirect URL."),(0,o.kt)("p",null,"We'll now go through each of the available hooks."),(0,o.kt)("h3",{id:"executing-code-before-the-user-signs-up"},"Executing code before the user signs up"),(0,o.kt)("p",null,"Wasp calls the ",(0,o.kt)("inlineCode",{parentName:"p"},"onBeforeSignup")," hook before the user is created."),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"onBeforeSignup")," hook can be useful if you want to reject a user based on some criteria before they sign up."),(0,o.kt)("p",null,"Works with ",(0,o.kt)(i.ge,{mdxType:"EmailPill"})," ",(0,o.kt)(i.f3,{mdxType:"UsernameAndPasswordPill"})," ",(0,o.kt)(i.Nl,{mdxType:"DiscordPill"})," ",(0,o.kt)(i.xS,{mdxType:"GithubPill"})," ",(0,o.kt)(i.p5,{mdxType:"GooglePill"})," ",(0,o.kt)(i.xQ,{mdxType:"KeycloakPill"})),(0,o.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,o.kt)(a.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-wasp",metastring:'title="main.wasp"',title:'"main.wasp"'},'app myApp {\n  ...\n  auth: {\n    ...\n    onBeforeSignup: import { onBeforeSignup } from "@src/auth/hooks",\n  },\n}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="src/auth/hooks.js"',title:'"src/auth/hooks.js"'},"import { HttpError } from 'wasp/server'\n\nexport const onBeforeSignup = async ({\n  providerId,\n  prisma,\n  req,\n}) => {\n  const count = await prisma.user.count()\n  console.log('number of users before', count)\n  console.log('provider name', providerId.providerName)\n  console.log('provider user ID', providerId.providerUserId)\n\n  if (count > 100) {\n    throw new HttpError(403, 'Too many users')\n  }\n\n  if (providerId.providerName === 'email' && providerId.providerUserId === 'some@email.com') {\n    throw new HttpError(403, 'This email is not allowed')\n  }\n}\n"))),(0,o.kt)(a.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-wasp",metastring:'title="main.wasp"',title:'"main.wasp"'},'app myApp {\n  ...\n  auth: {\n    ...\n    onBeforeSignup: import { onBeforeSignup } from "@src/auth/hooks",\n  },\n}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="src/auth/hooks.ts"',title:'"src/auth/hooks.ts"'},"import { HttpError } from 'wasp/server'\nimport type { OnBeforeSignupHook } from 'wasp/server/auth'\n\nexport const onBeforeSignup: OnBeforeSignupHook = async ({\n  providerId,\n  prisma,\n  req,\n}) => {\n  const count = await prisma.user.count()\n  console.log('number of users before', count)\n  console.log('provider name', providerId.providerName)\n  console.log('provider user ID', providerId.providerUserId)\n\n  if (count > 100) {\n    throw new HttpError(403, 'Too many users')\n  }\n\n  if (providerId.providerName === 'email' && providerId.providerUserId === 'some@email.com') {\n    throw new HttpError(403, 'This email is not allowed')\n  }\n}\n")))),(0,o.kt)("p",null,"Read more about the data the ",(0,o.kt)("inlineCode",{parentName:"p"},"onBeforeSignup")," hook receives in the ",(0,o.kt)("a",{parentName:"p",href:"#the-onbeforesignup-hook"},"API Reference"),"."),(0,o.kt)("h3",{id:"executing-code-after-the-user-signs-up"},"Executing code after the user signs up"),(0,o.kt)("p",null,"Wasp calls the ",(0,o.kt)("inlineCode",{parentName:"p"},"onAfterSignup")," hook after the user is created."),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"onAfterSignup")," hook can be useful if you want to send the user a welcome email or perform some other action after the user signs up like syncing the user with a third-party service."),(0,o.kt)("p",null,"Since the ",(0,o.kt)("inlineCode",{parentName:"p"},"onAfterSignup")," hook receives the OAuth access token, it can also be used to store the OAuth access token for the user in your database."),(0,o.kt)("p",null,"Works with ",(0,o.kt)(i.ge,{mdxType:"EmailPill"})," ",(0,o.kt)(i.f3,{mdxType:"UsernameAndPasswordPill"})," ",(0,o.kt)(i.Nl,{mdxType:"DiscordPill"})," ",(0,o.kt)(i.xS,{mdxType:"GithubPill"})," ",(0,o.kt)(i.p5,{mdxType:"GooglePill"})," ",(0,o.kt)(i.xQ,{mdxType:"KeycloakPill"})),(0,o.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,o.kt)(a.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-wasp",metastring:'title="main.wasp"',title:'"main.wasp"'},'app myApp {\n  ...\n  auth: {\n    ...\n    onAfterSignup: import { onAfterSignup } from "@src/auth/hooks",\n  },\n}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="src/auth/hooks.js"',title:'"src/auth/hooks.js"'},"export const onAfterSignup = async ({\n  providerId,\n  user,\n  oauth,\n  prisma,\n  req,\n}) => {\n  const count = await prisma.user.count()\n  console.log('number of users after', count)\n  console.log('user object', user)\n\n  // If this is an OAuth signup, we have the access token and uniqueRequestId\n  if (oauth) {\n    console.log('accessToken', oauth.accessToken)\n    console.log('uniqueRequestId', oauth.uniqueRequestId)\n\n    const id = oauth.uniqueRequestId\n    const data = someKindOfStore.get(id)\n    if (data) {\n      console.log('saved data for the ID', data)\n    }\n    someKindOfStore.delete(id)\n  }\n}\n"))),(0,o.kt)(a.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-wasp",metastring:'title="main.wasp"',title:'"main.wasp"'},'app myApp {\n  ...\n  auth: {\n    ...\n    onAfterSignup: import { onAfterSignup } from "@src/auth/hooks",\n  },\n}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="src/auth/hooks.ts"',title:'"src/auth/hooks.ts"'},"import type { OnAfterSignupHook } from 'wasp/server/auth'\n\nexport const onAfterSignup: OnAfterSignupHook = async ({\n  providerId,\n  user,\n  oauth,\n  prisma,\n  req,\n}) => {\n  const count = await prisma.user.count()\n  console.log('number of users after', count)\n  console.log('user object', user)\n\n  // If this is an OAuth signup, we have the access token and uniqueRequestId\n  if (oauth) {\n    console.log('accessToken', oauth.accessToken)\n    console.log('uniqueRequestId', oauth.uniqueRequestId)\n\n    const id = oauth.uniqueRequestId\n    const data = someKindOfStore.get(id)\n    if (data) {\n      console.log('saved data for the ID', data)\n    }\n    someKindOfStore.delete(id)\n  }\n}\n")))),(0,o.kt)("p",null,"Read more about the data the ",(0,o.kt)("inlineCode",{parentName:"p"},"onAfterSignup")," hook receives in the ",(0,o.kt)("a",{parentName:"p",href:"#the-onaftersignup-hook"},"API Reference"),"."),(0,o.kt)("h3",{id:"executing-code-before-the-oauth-redirect"},"Executing code before the OAuth redirect"),(0,o.kt)("p",null,"Wasp calls the ",(0,o.kt)("inlineCode",{parentName:"p"},"onBeforeOAuthRedirect")," hook after the OAuth redirect URL is generated but before redirecting the user. This hook can access the request object sent from the client at the start of the OAuth process."),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"onBeforeOAuthRedirect")," hook can be useful if you want to save some data (e.g. request query parameters) that can be used later in the OAuth flow. You can use the ",(0,o.kt)("inlineCode",{parentName:"p"},"uniqueRequestId")," parameter to reference this data later in the ",(0,o.kt)("inlineCode",{parentName:"p"},"onAfterSignup")," hook."),(0,o.kt)("p",null,"Works with ",(0,o.kt)(i.Nl,{mdxType:"DiscordPill"})," ",(0,o.kt)(i.xS,{mdxType:"GithubPill"})," ",(0,o.kt)(i.p5,{mdxType:"GooglePill"})," ",(0,o.kt)(i.xQ,{mdxType:"KeycloakPill"})),(0,o.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,o.kt)(a.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-wasp",metastring:'title="main.wasp"',title:'"main.wasp"'},'app myApp {\n  ...\n  auth: {\n    ...\n    onBeforeOAuthRedirect: import { onBeforeOAuthRedirect } from "@src/auth/hooks",\n  },\n}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="src/auth/hooks.js"',title:'"src/auth/hooks.js"'},"export const onBeforeOAuthRedirect = async ({\n  url,\n  uniqueRequestId,\n  prisma,\n  req,\n}) => {\n  console.log('query params before oAuth redirect', req.query)\n\n  // Saving query params for later use in the onAfterSignup hook\n  const id = uniqueRequestId\n  someKindOfStore.set(id, req.query)\n\n  return { url }\n}\n"))),(0,o.kt)(a.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-wasp",metastring:'title="main.wasp"',title:'"main.wasp"'},'app myApp {\n  ...\n  auth: {\n    ...\n    onBeforeOAuthRedirect: import { onBeforeOAuthRedirect } from "@src/auth/hooks",\n  },\n}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="src/auth/hooks.ts"',title:'"src/auth/hooks.ts"'},"import type { OnBeforeOAuthRedirectHook } from 'wasp/server/auth'\n\nexport const onBeforeOAuthRedirect: OnBeforeOAuthRedirectHook = async ({\n  url,\n  uniqueRequestId,\n  prisma,\n  req,\n}) => {\n  console.log('query params before oAuth redirect', req.query)\n\n  // Saving query params for later use in the onAfterSignup hook\n  const id = uniqueRequestId\n  someKindOfStore.set(id, req.query)\n\n  return { url }\n}\n")))),(0,o.kt)("p",null,"This hook's return value must be an object that looks like this: ",(0,o.kt)("inlineCode",{parentName:"p"},"{ url: URL }"),". Wasp uses the URL to redirect the user to the OAuth provider."),(0,o.kt)("p",null,"Read more about the data the ",(0,o.kt)("inlineCode",{parentName:"p"},"onBeforeOAuthRedirect")," hook receives in the ",(0,o.kt)("a",{parentName:"p",href:"#the-onbeforeoauthredirect-hook"},"API Reference"),"."),(0,o.kt)("h2",{id:"api-reference"},"API Reference"),(0,o.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,o.kt)(a.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-wasp"},'app myApp {\n  wasp: {\n    version: "^0.13.0"\n  },\n  auth: {\n    userEntity: User,\n    methods: {\n      ...\n    },\n    onBeforeSignup: import { onBeforeSignup } from "@src/auth/hooks",\n    onAfterSignup: import { onAfterSignup } from "@src/auth/hooks",\n    onBeforeOAuthRedirect: import { onBeforeOAuthRedirect } from "@src/auth/hooks",\n  },\n}\n'))),(0,o.kt)(a.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-wasp"},'app myApp {\n  wasp: {\n    version: "^0.13.0"\n  },\n  auth: {\n    userEntity: User,\n    methods: {\n      ...\n    },\n    onBeforeSignup: import { onBeforeSignup } from "@src/auth/hooks",\n    onAfterSignup: import { onAfterSignup } from "@src/auth/hooks",\n    onBeforeOAuthRedirect: import { onBeforeOAuthRedirect } from "@src/auth/hooks",\n  },\n}\n')))),(0,o.kt)("h3",{id:"the-onbeforesignup-hook"},"The ",(0,o.kt)("inlineCode",{parentName:"h3"},"onBeforeSignup")," hook"),(0,o.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,o.kt)(a.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="src/auth/hooks.js"',title:'"src/auth/hooks.js"'},"import { HttpError } from 'wasp/server'\n\nexport const onBeforeSignup = async ({\n  providerId,\n  prisma,\n  req,\n}) => {\n  // Hook code here\n}\n"))),(0,o.kt)(a.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="src/auth/hooks.ts"',title:'"src/auth/hooks.ts"'},"import { HttpError } from 'wasp/server'\nimport type { OnBeforeSignupHook } from 'wasp/server/auth'\n\nexport const onBeforeSignup: OnBeforeSignupHook = async ({\n  providerId,\n  prisma,\n  req,\n}) => {\n  // Hook code here\n}\n")))),(0,o.kt)("p",null,"The hook receives an object as ",(0,o.kt)("strong",{parentName:"p"},"input")," with the following properties:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"providerId: ProviderId")),(0,o.kt)("p",{parentName:"li"},"The user's provider ID is an object with two properties:"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"providerName: string")),(0,o.kt)("p",{parentName:"li"},"The provider's name (e.g. ",(0,o.kt)("inlineCode",{parentName:"p"},"'email'"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"'google'"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"'github'"),")")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"providerUserId: string")),(0,o.kt)("p",{parentName:"li"},"The user's unique ID in the provider's system (e.g. email, Google ID, GitHub ID)")))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"prisma: PrismaClient")),(0,o.kt)("p",{parentName:"li"},"The Prisma client instance which you can use to query your database.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"req: Request")),(0,o.kt)("p",{parentName:"li"},"The ",(0,o.kt)("a",{parentName:"p",href:"https://expressjs.com/en/api.html#req"},"Express request object")," from which you can access the request headers, cookies, etc."))),(0,o.kt)("p",null,"Wasp ignores this hook's ",(0,o.kt)("strong",{parentName:"p"},"return value"),"."),(0,o.kt)("h3",{id:"the-onaftersignup-hook"},"The ",(0,o.kt)("inlineCode",{parentName:"h3"},"onAfterSignup")," hook"),(0,o.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,o.kt)(a.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="src/auth/hooks.js"',title:'"src/auth/hooks.js"'},"export const onAfterSignup = async ({\n  providerId,\n  user,\n  oauth,\n  prisma,\n  req,\n}) => {\n  // Hook code here\n}\n"))),(0,o.kt)(a.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="src/auth/hooks.ts"',title:'"src/auth/hooks.ts"'},"import type { OnAfterSignupHook } from 'wasp/server/auth'\n\nexport const onAfterSignup: OnAfterSignupHook = async ({\n  providerId,\n  user,\n  oauth,\n  prisma,\n  req,\n}) => {\n  // Hook code here\n}\n")))),(0,o.kt)("p",null,"The hook receives an object as ",(0,o.kt)("strong",{parentName:"p"},"input")," with the following properties:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"providerId: ProviderId")),(0,o.kt)("p",{parentName:"li"},"The user's provider ID is an object with two properties:"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"providerName: string")),(0,o.kt)("p",{parentName:"li"},"The provider's name (e.g. ",(0,o.kt)("inlineCode",{parentName:"p"},"'email'"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"'google'"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"'github'"),")")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"providerUserId: string")))),(0,o.kt)("p",{parentName:"li"},"The user's unique ID in the provider's system (e.g. email, Google ID, GitHub ID)")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"user: User")),(0,o.kt)("p",{parentName:"li"},"The user object that was created.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"oauth?: OAuthFields")),(0,o.kt)("p",{parentName:"li"},"This object is present only when the user is created using ",(0,o.kt)("a",{parentName:"p",href:"/docs/auth/social-auth/overview"},"Social Auth"),".\nIt contains the following fields:"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"accessToken: string")),(0,o.kt)("p",{parentName:"li"},"You can use the OAuth access token to use the provider's API on user's behalf.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"uniqueRequestId: string")),(0,o.kt)("p",{parentName:"li"},"  The unique request ID for the OAuth flow (you might know it as the ",(0,o.kt)("inlineCode",{parentName:"p"},"state")," parameter in OAuth.)"),(0,o.kt)("p",{parentName:"li"},"  You can use the unique request ID to get the data saved in the ",(0,o.kt)("inlineCode",{parentName:"p"},"onBeforeOAuthRedirect")," hook.")))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"prisma: PrismaClient")),(0,o.kt)("p",{parentName:"li"},"The Prisma client instance which you can use to query your database.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"req: Request")),(0,o.kt)("p",{parentName:"li"},"The ",(0,o.kt)("a",{parentName:"p",href:"https://expressjs.com/en/api.html#req"},"Express request object")," from which you can access the request headers, cookies, etc."))),(0,o.kt)("p",null,"Wasp ignores this hook's ",(0,o.kt)("strong",{parentName:"p"},"return value"),"."),(0,o.kt)("h3",{id:"the-onbeforeoauthredirect-hook"},"The ",(0,o.kt)("inlineCode",{parentName:"h3"},"onBeforeOAuthRedirect")," hook"),(0,o.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,o.kt)(a.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="src/auth/hooks.js"',title:'"src/auth/hooks.js"'},"export const onBeforeOAuthRedirect = async ({\n  url,\n  uniqueRequestId,\n  prisma,\n  req,\n}) => {\n  // Hook code here\n\n  return { url }\n}\n"))),(0,o.kt)(a.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="src/auth/hooks.ts"',title:'"src/auth/hooks.ts"'},"import type { OnBeforeOAuthRedirectHook } from 'wasp/server/auth'\n\nexport const onBeforeOAuthRedirect: OnBeforeOAuthRedirectHook = async ({\n  url,\n  uniqueRequestId,\n  prisma,\n  req,\n}) => {\n  // Hook code here\n\n  return { url }\n}\n")))),(0,o.kt)("p",null,"The hook receives an object as ",(0,o.kt)("strong",{parentName:"p"},"input")," with the following properties:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"url: URL")),(0,o.kt)("p",{parentName:"li"},"  Wasp uses the URL for the OAuth redirect.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"uniqueRequestId: string")),(0,o.kt)("p",{parentName:"li"},"  The unique request ID for the OAuth flow (you might know it as the ",(0,o.kt)("inlineCode",{parentName:"p"},"state")," parameter in OAuth.)"),(0,o.kt)("p",{parentName:"li"},"  You can use the unique request ID to save data (e.g. request query params) that you can later use in the ",(0,o.kt)("inlineCode",{parentName:"p"},"onAfterSignup")," hook.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"prisma: PrismaClient")),(0,o.kt)("p",{parentName:"li"},"  The Prisma client instance which you can use to query your database.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"req: Request")),(0,o.kt)("p",{parentName:"li"},"The ",(0,o.kt)("a",{parentName:"p",href:"https://expressjs.com/en/api.html#req"},"Express request object")," from which you can access the request headers, cookies, etc."))),(0,o.kt)("p",null,"This hook's return value must be an object that looks like this: ",(0,o.kt)("inlineCode",{parentName:"p"},"{ url: URL }"),". Wasp uses the URL to redirect the user to the OAuth provider."))}f.isMDXComponent=!0}}]);